name: åŸºé‡‘è‡ªåŠ¨å·¡èˆª

on:
  schedule:
    # æ¯å¤©åŒ—äº¬æ—¶é—´ 14:45 è¿è¡Œ (UTC 06:45)
    - cron: '45 6 * * 1-5'
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨ç‚¹å‡»è¿è¡Œ

jobs:
  run_bot:
    runs-on: ubuntu-latest
    
    steps:
    - name: ä¸‹è½½ä»£ç 
      uses: actions/checkout@v2
      
    - name: å®‰è£… Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.10'
        
    - name: å®‰è£…ä¾èµ–åº“
      run: |
        pip install akshare pandas requests sqlalchemy pymysql
        
    # --- ğŸ”¥ã€æ–°å¢æ­¥éª¤ã€‘ç°åœºç”Ÿæˆ config.py ---
    - name: ç”Ÿæˆé…ç½®æ–‡ä»¶
      run: |
        echo "import os" > config.py
        echo "PUSH_CONFIG = {'token': os.environ.get('PUSH_TOKEN')}" >> config.py
        echo "DB_CONFIG = {'user': 'root', 'password': os.environ.get('DB_PASSWORD'), 'host': os.environ.get('DB_HOST'), 'port': 3306, 'database': 'fund_db'}" >> config.py
        echo "MY_FUNDS = {" >> config.py
        echo "    '012363': 'å›½æ³°è¯åˆ¸'," >> config.py
        echo "    '015916': 'æ°¸èµ¢åŒ»è¯'," >> config.py
        echo "    '013275': 'å¯Œå›½ç…¤ç‚­'," >> config.py
        echo "    '270042': 'å¹¿å‘çº³æŒ‡100'," >> config.py
        echo "    '017437': 'åå®çº³æŒ‡ç²¾é€‰'" >> config.py
        echo "}" >> config.py
        
    - name: è¿è¡Œä¾¦å¯Ÿå…µ (Realtime)
      env:
        # æŠŠ GitHub Secrets æ³¨å…¥åˆ°ç¯å¢ƒå˜é‡
        PUSH_TOKEN: ${{ secrets.PUSH_TOKEN }}
        DB_PASSWORD: ${{ secrets.DB_PASSWORD }}
        DB_HOST: ${{ secrets.DB_HOST }}
      run: python realtime.py