name: æ™šé—´è‡ªåŠ¨å¤ç›˜

on:
  schedule:
    # æ¯å¤©åŒ—äº¬æ—¶é—´ 22:00 è¿è¡Œ (UTC 14:00)
    - cron: '0 14 * * 1-5'
  workflow_dispatch: # å…è®¸ä½ æ‰‹åŠ¨ç‚¹å‡»è¿è¡Œæµ‹è¯•

jobs:
  run_job:
    runs-on: ubuntu-latest
    
    steps:
    - name: ä¸‹è½½ä»£ç 
      uses: actions/checkout@v2
      
    - name: å®‰è£… Python 3.10
      uses: actions/setup-python@v2
      with:
        python-version: '3.10'
        
    - name: å®‰è£…ä¾èµ–åº“
      # åŠ ä¸Š cryptography æ˜¯ä¸ºäº†é˜²æ­¢ MySQL 8.0 è¿æ¥æŠ¥é”™
      run: |
        pip install akshare pandas requests sqlalchemy pymysql matplotlib seaborn cryptography

    - name: ç”Ÿæˆäº‘ç«¯ä¸“ç”¨é…ç½®æ–‡ä»¶
      run: |
        echo "import os" > config.py
        echo "def get_env(k, d): return os.environ.get(k, d)" >> config.py
        
        # --- ğŸ”¥ å…³é”®ä¿®æ”¹ï¼šç›´æ¥å†™æ­» bot è´¦å· ---
        echo "DB_CONFIG = {" >> config.py
        echo "    'user': 'bot'," >> config.py 
        echo "    'password': 'Bot123456'," >> config.py  # <--- ç›´æ¥æŠŠ bot çš„å¯†ç å†™åœ¨è¿™ï¼
        echo "    'host': os.environ.get('DB_HOST')," >> config.py
        echo "    'port': 3306," >> config.py
        echo "    'database': 'fund_db'" >> config.py
        echo "}" >> config.py
        
        # ... (åé¢ PushPlus å’Œ MyFunds ä¸å˜) ...
        echo "PUSH_CONFIG = {'token': os.environ.get('PUSH_TOKEN')}" >> config.py
        echo "MY_FUNDS = {" >> config.py
        echo "    '012363': 'å›½æ³°è¯åˆ¸'," >> config.py
        echo "    '006479': 'å¹¿å‘çº³æŒ‡100'," >> config.py
        echo "    '012341': 'åå®çº³æŒ‡ç²¾é€‰'" >> config.py
        # 2. ç…¤ç‚­å’ŒåŒ»è¯å·²ç»è¢«æˆ‘åˆ æ‰äº†ï¼
        echo "}" >> config.py
    - name: è¿è¡Œä¸»ç¨‹åº
      env:
        # æŠŠ Secrets æ³¨å…¥åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼Œç»™ config.py è¯»å–
        DB_HOST: ${{ secrets.DB_HOST }}
        DB_PASSWORD: ${{ secrets.DB_PASSWORD }}
        DB_USER: ${{ secrets.DB_USER }}
        PUSH_TOKEN: ${{ secrets.PUSH_TOKEN }}
      run: python main.py